(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{519:function(e,t,n){
/*! css-doodle@0.19.1 */
e.exports=function(){"use strict";const e={":":"colon",";":"semicolon",",":"comma","(":"left-paren",")":"right-paren","[":"left-square-bracket","]":"right-square-bracket","{":"left-curly-brace","}":"right-curly-brace","π":"pi","±":"plus-or-minus","+":"plus","-":"minus","*":"product","/":"division","%":"mod",'"':"double-quote","'":"single-quote","`":"backquote","@":"at"},t={escape:e=>"\\"==e,space:e=>/[\r\n\t\s]/.test(e),digit:e=>/^[0-9]$/.test(e),sign:e=>/^[+-]$/.test(e),dot:e=>"."==e,quote:e=>/^["'`]$/.test(e),symbol:t=>e[t],hexNum:e=>/^[0-9a-f]$/i.test(e),hex:(e,n,r)=>"0"==e&&t.letter(n,"x")&&t.hexNum(r),expWithSign:(e,n,r)=>t.letter(e,"e")&&t.sign(n)&&t.digit(r),exp:(e,n)=>t.letter(e,"e")&&t.digit(n),dots:(e,n)=>t.dot(e)&&t.dot(n),letter:(e,t)=>String(e).toLowerCase()==String(t).toLowerCase(),comment:(e,t)=>"/"==e&&"*"==t,selfClosedTag:(e,t)=>"/"==e&&">"==t,closedTag:(e,t)=>"<"==e&&"/"==t};class n{constructor({type:e,value:t,pos:n,status:r}){this.type=e,this.value=t,this.pos=n,r&&(this.status=r)}isSymbol(...e){let t="Symbol"==this.type;return e.length?e.some(e=>e===this.value):t}isSpace(){return"Space"==this.type}isNumber(){return"Number"==this.type}isWord(){return"Word"==this.type}}function r(e){let t=-1,n=e.length,r=-1,i=0;return{curr:(n=0)=>e[t+n],next(n=1){let s=e[t+=n];return"\n"==s?(i++,r=0):r+=n,s},end:()=>t>=n,get:()=>({prev:e[t-1],curr:e[t+0],next:e[t+1],next2:e[t+2],next3:e[t+3],pos:[r,i]})}}function i(e){for(;e.next();){let{curr:n,prev:r}=e.get();if(t.comment(n,r))break}}function s(e){return[":",";",",","{","}","(",")","[","]"].includes(e)}function o(e){let n="";for(;!e.end();){let{curr:r,next:i}=e.get();n+=r;let s=t.symbol(i)||t.space(i)||t.digit(i);if(n.length&&s&&!t.closedTag(r,i))break;e.next()}return n.trim()}function l(e){let n="";for(;!e.end();){let{curr:r,next:i}=e.get();if(n+=r,!t.space(i))break;e.next()}return n}function a(e){let n="",r=!1;for(;!e.end();){let{curr:i,next:s,next2:o,next3:l}=e.get();if(n+=i,r&&t.dot(s))break;if(t.dot(i)&&(r=!0),t.dots(s,o))break;if(t.expWithSign(s,o,l))n+=e.next()+e.next();else if(t.exp(s,o))n+=e.next();else if(!t.digit(s)&&!t.dot(s))break;e.next()}return n}function u(e){let n="0x";for(e.next(2);!e.end();){let{curr:r,next:i}=e.get();if(n+=r,!t.hexNum(i))break;e.next()}return n}function c(e){return e[e.length-1]}function h(e){let h=r(String(e).trim()),p=[],d=[];for(;h.next();){let{prev:e,curr:r,next:f,next2:m,pos:g}=h.get();if(t.comment(r,f))i(h);else if(t.hex(r,f,m)){let e=u(h);p.push(new n({type:"Number",value:e,pos:g}))}else if(t.digit(r)||t.digit(f)&&t.dot(r)&&!t.dots(e,r)){let e=a(h);p.push(new n({type:"Number",value:e,pos:g}))}else if(t.symbol(r)&&!t.selfClosedTag(r,f)){let e=c(p);if("-"===r&&t.digit(f)&&(!e||!e.isNumber())){let e=a(h);p.push(new n({type:"Number",value:e,pos:g}));continue}let i={type:"Symbol",value:r,pos:g};if(d.length&&t.escape(e.value)){p.pop();let e=o(h);e.length&&p.push(new n({type:"Word",value:e,pos:g}))}else t.quote(r)&&(c(d)==r?(d.pop(),i.status="close"):(d.push(r),i.status="open")),p.push(new n(i))}else if(t.space(r)){let e=l(h),t=c(p),{next:r}=h.get();if(!d.length&&t){if(s(t.value)||s(r))continue;e=" "}p.length&&r&&r.trim()&&p.push(new n({type:"Space",value:e,pos:g}))}else{let e=o(h);e.length&&p.push(new n({type:"Word",value:e,pos:g}))}}let f=c(p);return f&&f.isSpace()&&(p.length=p.length-1),p}function p(e){let t=[];for(;e.next();){let{curr:r,next:i}=e.get();if("var"===r.value){if(i&&i.isSymbol("(")){e.next();let r=d(e);void 0!==(n=r.name)&&!(n.length<=2)&&!n.substr(2).startsWith("-")&&n.startsWith("--")&&t.push(r)}}else if(t.length&&!r.isSymbol(","))break}var n;return t}function d(e){let t={},n=[];for(;e.next();){let{curr:r,next:i}=e.get();if(r.isSymbol(")",";")&&!t.name){t.name=f(n);break}r.isSymbol(",")?(void 0===t.name&&(t.name=f(n),n=[]),t.name&&(t.fallback=p(e))):n.push(r)}return t}function f(e){return e.map(e=>e.value).join("")}function m(e){return{make_array:function(e){return Array.isArray(e)?e:[e]},join:function(e,t="\n"){return(e||[]).join(t)},last:function(e,t=1){return e[e.length-t]},first:function(e){return e[0]},clone:function(e){return JSON.parse(JSON.stringify(e))},shuffle:function(t){let n=Array.from?Array.from(t):t.slice(),r=t.length;for(;r;){let t=~~(e()*r--),i=n[r];n[r]=n[t],n[t]=i}return n},flat_map:function(e,t){return Array.prototype.flatMap?e.flatMap(t):e.reduce((e,n)=>e.concat(t(n)),[])},remove_empty_values:function(e){return e.filter(e=>null!=e&&String(e).trim().length)}}}let{first:g,last:y,clone:v}=m();const x={func:(e="")=>({type:"func",name:e,arguments:[]}),argument:()=>({type:"argument",value:[]}),text:(e="")=>({type:"text",value:e}),pseudo:(e="")=>({type:"pseudo",selector:e,styles:[]}),cond:(e="")=>({type:"cond",name:e,styles:[],arguments:[]}),rule:(e="")=>({type:"rule",property:e,value:[]}),keyframes:(e="")=>({type:"keyframes",name:e,steps:[]}),step:(e="")=>({type:"step",name:e,styles:[]})},b={white_space:e=>/[\s\n\t]/.test(e),line_break:e=>/\n/.test(e),number:e=>!isNaN(e),pair:e=>['"',"(",")","'"].includes(e),pair_of:(e,t)=>({'"':'"',"'":"'","(":")"}[e]==t)},_={"π":Math.PI,"∏":Math.PI};function w(e){return["@canvas","@shaders","@doodle"].includes(e)}function k(e,{col:t,line:n}){console.warn(`(at line ${n}, column ${t}) ${e}`)}function $(e){return function(t,n){let r=t.index(),i="";for(;!t.end();){let n=t.next();if(e(n))break;i+=n}return n&&t.index(r),i}}function S(e,t){return $(e=>/[^\w@]/.test(e))(e,t)}function E(e){return $(e=>/[\s\{]/.test(e))(e)}function j(e,t){return $(e=>b.line_break(e)||"{"==e)(e,t)}function z(e,t){let n,r=x.step();for(;!e.end()&&"}"!=(n=e.curr());)if(b.white_space(n))e.next();else{if(r.name.length){if(r.styles.push(q(e,t)),"}"==e.curr())break}else r.name=I(e);e.next()}return r}function T(e,t){const n=[];let r;for(;!e.end()&&"}"!=(r=e.curr());)b.white_space(r)||n.push(z(e,t)),e.next();return n}function A(e,t){let n,r=x.keyframes();for(;!e.end()&&"}"!=(n=e.curr());)if(r.name.length){if("{"==n){e.next(),r.steps=T(e,t);break}e.next()}else if(S(e),r.name=E(e),!r.name.length){k("missing keyframes name",e.info());break}return r}function R(e,t={}){for(e.next();!e.end();){let n=e.curr();if(t.inline){if("\n"==n)break}else if("*"==(n=e.curr())&&"/"==e.curr(1))break;e.next()}t.inline||(e.next(),e.next())}function P(e){for(e.next();!e.end()&&">"!=e.curr();)e.next()}function C(e){let t,n="";for(;!e.end()&&":"!=(t=e.curr());)b.white_space(t)||(n+=t),e.next();return n}function M(e,t,n){let r,i=[],s=[],o=[],l="";for(;!e.end();){if(r=e.curr(),/[\('"`]/.test(r)&&"\\"!==e.curr(-1))o.length&&"("!=r&&r===y(o)?o.pop():o.push(r),l+=r;else if("@"!=r||n)if(n&&/[)]/.test(r)||!n&&/[,)]/.test(r))if(o.length)")"==r&&o.pop(),l+=r;else{if(l.length&&(s.length?s.push(x.text(l)):s.push(x.text((a=l).trim().length?b.number(+a)?+a:a.trim():a)),l.startsWith("±")&&!n)){let e=l.substr(1),t=v(s);y(t).value="-"+e,i.push(L(t)),y(s).value=e}if(i.push(L(s)),[s,l]=[[],""],")"==r)break}else _[r]&&!/[0-9]/.test(e.curr(-1))&&(r=_[r]),l+=r;else s.length||(l=l.trimLeft()),l.length&&(s.push(x.text(l)),l=""),s.push(N(e));if(!(!t||")"!=e.curr()&&/[0-9a-zA-Z_\-.]/.test(e.curr())||o.length)){s.length&&i.push(L(s));break}e.next()}var a;return i}function L(e){let t=e.map(e=>{if("text"==e.type&&"string"==typeof e.value){let t=String(e.value);t.includes("`")&&(e.value=t=t.replace(/`/g,'"')),e.value=t.replace(/\n+|\s+/g," ")}return e}),n=g(t)||{},r=y(t)||{};if("text"==n.type&&"text"==r.type){let e=g(n.value),i=y(r.value);"string"==typeof n.value&&"string"==typeof r.value&&b.pair_of(e,i)&&(n.value=n.value.slice(1),r.value=r.value.slice(0,r.value.length-1),t.cluster=!0)}return t}function N(e){let t,n=x.func(),r="@",i=!1;for(e.next();!e.end();){t=e.curr();let s="."==t&&"@"==e.curr(1),o=e.curr(1);if("("==t||s){i=!0,e.next(),n.arguments=M(e,s,w(r));break}if(!i&&"("!==o&&!/[0-9a-zA-Z_\-.]/.test(o)){r+=t;break}r+=t,e.next()}let{fname:s,extra:o}=function(e){let t="",n="";if(/\D$/.test(e)&&!/\d+x\d+/.test(e)||Math[e.substr(1)])return{fname:e,extra:n};for(let r=e.length-1;r>=0;r--){let i=e[r],s=e[r-1],o=e[r+1];if(!(/[\d.]/.test(i)||"x"==i&&/\d/.test(s)&&/\d/.test(o))){t=e.substring(0,r+1);break}n=i+n}return{fname:t,extra:n}}(r);return n.name=s,o.length&&n.arguments.unshift([{type:"text",value:o}]),n.position=e.info().index,n}function O(e){let t,n=x.text(),r=0,i=!0;const s=[],o=[];for(s[r]=[];!e.end();)if(t=e.curr(),i&&b.white_space(t))e.next();else{if(i=!1,"\n"!=t||b.white_space(e.curr(-1)))if(","!=t||o.length){if(/[;}<]/.test(t)){n.value.length&&(s[r].push(n),n=x.text());break}"@"==t?(n.value.length&&(s[r].push(n),n=x.text()),s[r].push(N(e))):b.white_space(t)&&b.white_space(e.curr(-1))||("("==t&&o.push(t),")"==t&&o.pop(),_[t]&&!/[0-9]/.test(e.curr(-1))&&(t=_[t]),n.value+=t)}else n.value.length&&(s[r].push(n),n=x.text()),s[++r]=[],i=!0;else n.value+=" ";e.next()}return n.value.length&&s[r].push(n),s}function I(e){let t,n="";for(;!e.end()&&"{"!=(t=e.curr());)b.white_space(t)||(n+=t),e.next();return n}function U(e){let t,n={name:"",arguments:[]};for(;!e.end();){if("("==(t=e.curr()))e.next(),n.arguments=M(e);else{if(/[){]/.test(t))break;b.white_space(t)||(n.name+=t)}e.next()}return n}function W(e,t){let n,r=x.pseudo();for(;!e.end()&&"}"!=(n=e.curr());)if(b.white_space(n))e.next();else{if(r.selector){let n=q(e,t);if("@use"==n.property?r.styles=r.styles.concat(n.value):r.styles.push(n),"}"==e.curr())break}else r.selector=I(e);e.next()}return r}function q(e,t){let n=x.rule();for(;!e.end()&&";"!=e.curr();){if(n.property.length){n.value=O(e);break}if(n.property=C(e),"@use"==n.property){n.value=F(e,t);break}e.next()}return n}function D(e,t){let n,r=x.cond();for(;!e.end()&&"}"!=(n=e.curr());){if(r.name.length)if(":"==n){let t=W(e);t.selector&&r.styles.push(t)}else if("@"!=n||j(e,!0).includes(":")){if(!b.white_space(n)){let n=q(e,t);if(n.property&&r.styles.push(n),"}"==e.curr())break}}else r.styles.push(D(e));else Object.assign(r,U(e));e.next()}return r}function H(e,t){let n="";return e&&e.get_variable&&(n=e.get_variable(t)),n}function B(e,t){e.forEach&&e.forEach(e=>{if("text"==e.type&&e.value){let n=p(r(h(e.value)));e.value=n.reduce((e,n)=>{let r,i="",s="";i=H(t,n.name),!i&&n.fallback&&n.fallback.every(e=>{if(s=H(t,e.name),s)return i=s,!1});try{r=V(i,t)}catch(e){}return r&&e.push.apply(e,r),e},[])}"func"==e.type&&e.arguments&&e.arguments.forEach(e=>{B(e,t)})})}function F(e,t){return e.next(),(O(e)||[]).reduce((e,n)=>{B(n,t);let[r]=n;return r.value&&r.value.length&&e.push(...r.value),e},[])}function V(e,t){const n=function(e=""){let t=0,n=1,r=1;return{curr:(n=0)=>e[t+n],end:()=>e.length<=t,info:()=>({index:t,col:n,line:r}),index:e=>void 0===e?t:t=e,next(){let i=e[t++];return"\n"==i?(r++,n=0):n++,i}}}(e),r=[];for(;!n.end();){let e=n.curr();if(b.white_space(e))n.next();else{if("/"==e&&"*"==n.curr(1))R(n);else if("/"==e&&"/"==n.curr(1))R(n,{inline:!0});else if(":"==e){let e=W(n,t);e.selector&&r.push(e)}else if("@"==e&&"@keyframes"===S(n,!0)){let e=A(n,t);r.push(e)}else if("@"!=e||j(n,!0).includes(":")){if("<"==e)P(n);else if(!b.white_space(e)){let e=q(n,t);e.property&&r.push(e)}}else{let e=D(n,t);e.name.length&&r.push(e)}n.next()}}return r}function X(e,t,n){return Math.max(t,Math.min(n,e))}function G(e,t,n){let r=0,i=e,s=e=>e>0&&e<1?.1:1,o=arguments.length;1==o&&([e,t]=[s(e),e]),o<3&&(n=s(e));let l=[];for(;(n>=0&&e<=t||n<0&&e>t)&&(l.push(e),e+=n,!(r++>=1e3)););return l.length||l.push(i),l}function Z(e){return/^[a-zA-Z]$/.test(e)}function Y(e){return null==e}function J(e){return Y(e)||""===e}function K(e){let t=()=>e;return t.lazy=!0,t}function Q(e,t,n){return"c-"+e+"-"+t+"-"+n}function ee(e){for(;e&&e.value;)return ee(e.value);return Y(e)?"":e}function te(e,t,n=0){let r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=function(){setTimeout(t,n)}}function ne(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function re(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function ie(e){return(t,...n)=>{let r=t.reduce((e,t,r)=>{return e+t+(Y(i=n[r])?"":i);var i},"");return e(r)}}const[se,oe,le]=[1,32,1024];function ae(e){let[t,n,r]=(e+"").replace(/\s+/g,"").replace(/[,，xX]+/g,"x").split("x").map(e=>parseInt(e));const i=1==t||1==n?le:oe,s=1==t&&1==n?le:se,o={x:X(t||se,1,i),y:X(n||t||se,1,i),z:X(r||se,1,s)};return Object.assign({},o,{count:o.x*o.y*o.z,ratio:o.x/o.y})}function ue(e){return/^texture\w*$|^(fragment|vertex)$/.test(e)}function ce(){return new n({type:"LineBreak",value:"\n"})}function he(e){let t=e[0],n=e[e.length-1];for(;t&&t.isSymbol("(")&&n&&n.isSymbol(")");)t=(e=e.slice(1,e.length-1))[0],n=e[e.length-1];return e}function pe(e){return he(e).map(e=>e.value).join("")}const de="http://www.w3.org/2000/svg";function fe(e,t){return`url("data:image/svg+xml;utf8,${encodeURIComponent(e)+(t?"#"+t:"")}")`}function me(e){const t=`xmlns="${de}"`;return e.includes("<svg")||(e=`<svg ${t}>${e}</svg>`),e.includes("xmlns")||(e=e.replace(/<svg([\s>])/,`<svg ${t}$1`)),e}function ge(e,t,n){if(t||(t=document.createDocumentFragment()),"block"===e.type)try{let n=document.createElementNS(de,e.name);n&&(e.value.forEach(t=>{ge(t,n,e)}),t.appendChild(n))}catch(e){}if("statement"===e.type)if(n&&"text"==n.name&&"content"===e.name)t.textContent=e.value;else try{t.setAttributeNS(de,e.name,e.value)}catch(e){}if(!n){let e=t.childNodes[0];return e&&e.outerHTML||""}return t}function ye(e){function t(e,t,n){return e*(1-n)+t*n}return{lerp:t,rand:function(n=0,r){return 1==arguments.length&&([n,r]=[0,n]),t(n,r,e())},nrand:function(t=0,n=1){let r=0,i=0;for(;0===r;)r=e();for(;0===i;)i=e();const s=Math.sqrt(-2*Math.log(r)),o=2*Math.PI*i;return t+n*(s*Math.cos(o))},pick:function(...t){let n=t.reduce((e,t)=>e.concat(t),[]);return n[~~(e()*n.length)]},unique_id:function(e=""){return e+Math.random().toString(32).substr(2)}}}function ve(e){return(...t)=>{let n=function(e){let t="";return e.some(e=>{let n=String(e).trim();if(!n)return"";let r=n.match(/\d(\D+)$/);return t=r?r[1]:""}),t}(t);return function(e,t){return(...n)=>{n=n.map(e=>Number(String(e).replace(/\D+$/g,"")));let r=e.apply(null,n);return t.length?Array.isArray(r)?r.map(e=>e+t):r+t:r}}(e,n).apply(null,t)}}function xe(e){return(...t)=>{let n=t.map(e=>String(e).charCodeAt(0)),r=e.apply(null,n);return Array.isArray(r)?r.map(e=>String.fromCharCode(e)):String.fromCharCode(r)}}let{last:be}=m();const _e={"π":Math.PI,"∏":Math.PI};function we(e,t){return $e(Se(e),Object.assign(_e,t))}const ke={"^":4,"*":3,"/":3,"%":3,"+":2,"-":2,"(":1,")":1};function $e(e,t,n=[]){let r=[];for(;e.length;){let{name:s,value:o,type:l}=e.shift();if("variable"===l){let e=t[o];void 0===e&&(e=Math[o]),void 0===e&&(e=je(o,t)),void 0===e&&(e=0),"number"!=typeof e&&(n.push(e),(i=n)[0]==i[2]&&i[1]==i[3]?(e=0,n=[]):e=$e(Se(e),t,n)),r.push(e)}else if("function"===l){let e,n=o.map(e=>$e(e,t)),i=s.split(".");for(;e=i.pop();){if(!e)continue;let r=t[e]||Math[e];n="function"==typeof r?Array.isArray(n)?r(...n):r(n):0}r.push(n)}else if(/\d+/.test(o))r.push(o);else{let e=r.pop(),t=r.pop();r.push(Ee(o,Number(t),Number(e)))}}var i;return r[0]}function Se(e){let t=function(e){let t=String(e),n=[],r="";for(let e=0;e<t.length;++e){let i=t[e];if(ke[i])if("-"==i&&"e"==t[e-1])r+=i;else if(n.length||r.length||!/[+-]/.test(i)){let{type:e,value:t}=be(n)||{};"operator"==e&&!r.length&&/[^()]/.test(i)&&/[^()]/.test(t)?r+=i:(r.length&&(n.push({type:"number",value:r}),r=""),n.push({type:"operator",value:i}))}else r+=i;else/\S/.test(i)&&(","==i?(n.push({type:"number",value:r}),r="",n.push({type:"comma",value:i})):r+=i)}return r.length&&n.push({type:"number",value:r}),n}(e);const n=[],r=[];for(let e=0;e<t.length;++e){let{type:i,value:s}=t[e],o=t[e+1]||{};if("number"==i)if("("==o.value&&/[^\d.\-]/.test(s)){let n="",i=[],o=[];for(e+=1;void 0!==t[e++];){let r=t[e];if(void 0===r)break;let s=r.value;if(")"==s){if(!i.length)break;i.pop(),n+=s}else if("("==s&&i.push(s),","!=s||i.length)n+=s;else{let e=Se(n);e.length&&o.push(e),n=""}}n.length&&o.push(Se(n)),r.push({type:"function",name:s,value:o})}else/[^\d.\-]/.test(s)?r.push({type:"variable",value:s}):r.push({type:"number",value:s});else if("operator"==i)if("("==s)n.push(s);else if(")"==s){for(;n.length&&"("!=be(n);)r.push({type:"operator",value:n.pop()});n.pop()}else{for(;n.length&&ke[be(n)]>=ke[s];){let e=n.pop();/[()]/.test(e)||r.push({type:"operator",value:e})}n.push(s)}}for(;n.length;)r.push({type:"operator",value:n.pop()});return r}function Ee(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n)}}function je(e,t){let[n,r,i]=e.match(/([\d.\-]+)(.*)/)||[],s=t[i];return void 0===s?s:"number"==typeof s?Number(r)*s:r*$e(Se(s),t)}const ze={};function Te(e,t){return(...n)=>{let r=e+n.join("-");return ze[r]?ze[r]:ze[r]=t.apply(null,n)}}const{last:Ae,flat_map:Re}=m();function Pe(e){return(...t)=>e.apply(null,Re(t,e=>String(e).startsWith("[")?Me(e):e))}function Ce(e,t){return{type:e,value:t}}const Me=Te("build_range",e=>{let t=function(e){let t=String(e),n=[],r=[];if(!t.startsWith("[")||!t.endsWith("]"))return n;for(let e=1;e<t.length-1;++e){let i=t[e];if("-"!=i||"-"!=t[e-1])if("-"!=i)if("-"!=Ae(r))r.length&&n.push(Ce("char",r.pop())),r.push(i);else{r.pop();let e=r.pop();n.push(e?Ce("range",[e,i]):Ce("char",i))}else r.push(i)}return r.length&&n.push(Ce("char",r.pop())),n}(e);return Re(t,({type:e,value:t})=>{if("char"==e)return t;let[n,r]=t,i=!1;n>r&&([n,r]=[r,n],i=!0);let s=xe(G)(n,r);return i&&s.reverse(),s})});class Le{constructor(e){this.prev=this.next=null,this.data=e}}class Ne{constructor(e=20){this._limit=e,this._size=0}push(e){this._size>=this._limit&&(this.root=this.root.next,this.root.prev=null);let t=new Le(e);this.root?(t.prev=this.tail,this.tail.next=t,this.tail=t):this.root=this.tail=t,this._size++}last(e=1){let t=this.tail;for(;--e&&t.prev;)t=t.prev;return t.data}}function Oe(e){let t,n=r(h(e)),i={},s=[];for(;n.next();){let{curr:e,next:r}=n.get();e.isSymbol(":")&&!t?(t=Ie(s),s=[]):e.isSymbol(";")&&t?(i[t]=Ie(s),s=[],t=null):e.isSymbol(";")||s.push(e)}return s.length&&t&&(i[t]=Ie(s)),i}function Ie(e){return e.map(e=>e.value).join("")}const{cos:Ue,sin:We,atan2:qe,PI:De}=Math,He=ie(e=>Fe(Oe(e),{min:3,max:3600})),Be={circle:()=>He`
    split: 180;
    scale: .99
  `,triangle:()=>He`
    rotate: 30;
    scale: 1.1;
    origin: 0 .2
  `,pentagon:()=>He`
    split: 5;
    rotate: 54
  `,hexagon:()=>He`
    split: 6;
    rotate: 30;
    scale: .98
  `,octagon:()=>He`
    split: 8;
    rotat: 22.5;
    scale: .99
  `,star:()=>He`
    split: 10;
    r: cos(5t);
    rotate: -18;
    scale: .99
  `,infinity:()=>He`
    split: 180;
    scale: .99;
    x: cos(t)*.99 / (sin(t)^2 + 1);
    y: x * sin(t)
  `,heart:()=>He`
    split: 180;
    rotate: 180;
    a: cos(t)*13/18 - cos(2t)*5/18;
    b: cos(3t)/18 + cos(4t)/18;
    x: (.75 * sin(t)^3) * 1.2;
    y: (a - b + .2) * 1.1
  `,bean:()=>He`
    split: 180;
    rotate: -90;
    origin: -.45 .45;
    r: sin(t)^3 + cos(t)^3
  `,bicorn:()=>He`
    split: 180;
    x: cos(t);
    y: sin(t)^2 / (2 + sin(t)) - .5
  `,drop:()=>He`
    split: 180;
    rotate: 90;
    scale: .95;
    x: sin(t);
    y: (1 + sin(t)) * cos(t) / 1.6
  `,fish:()=>He`
    split: 240;
    x: cos(t) - sin(t)^2 / sqrt(2);
    y: sin(2t)/2
  `,whale:()=>He`
    split: 240;
    rotate: 180;
    R: 3.4 * (sin(t)^2 - .5) * cos(t);
    x: cos(t) * R + .75;
    y: sin(t) * R * 1.2
  `,windmill:()=>He`
    split: 18;
    R: seq(.618, 1, 0);
    T: seq(t+.55, t, t);
    x: R * cos(T);
    y: R * sin(T);
  `,vase:()=>He`
    split: 240;
    scale: .3;
    rotate: 180;
    x: sin(4t) + sin(t) * 1.4;
    y: cos(t) + cos(t) * 4.8 + .3
  `,clover:(e=3)=>(4==(e=X(e,3,5))&&(e=2),He`
      split: 240;
      r: cos(${e}t);
      scale: .98
    `),hypocycloid:(e=3)=>(e=X(e,3,5),He`
      split: 240;
      scale: ${[0,0,0,.34,.25,.19][e]};
      k: ${e};
      x: (k-1)*cos(t) + cos((k-1)*t);
      y: (k-1)*sin(t) - sin((k-1)*t)
    `),bud:(e=3)=>(e=X(e,3,10),He`
      split: 240;
      scale: .8;
      r: 1 + .2 * cos(${e}t)
    `)};function Fe(e,{min:t,max:n}){let r=X(parseInt(e.points||e.split)||0,t,n),i=Object.assign({},e,{split:r}),s=J(e.x)?"cos(t)":e.x,o=J(e.y)?"sin(t)":e.y,l=J(e.r)?"":e.r;return e.degree&&(e.rotate=e.degree),function(e,t){"function"==typeof arguments[0]&&(t=e,e={}),t||(t=e=>[Ue(e),We(e)]);let n,r,i=e.split||180,s=e.scale||1,o=e.turn||1,l=e.frame,a=e["fill-rule"],u=2*De*o/i,c=[];"nonzero"!=a&&"evenodd"!=a||c.push(a);let h=([t,n])=>{let r=50*t*s+50+"%",i=50*n*s+50+"%";e.absolute&&(r=t*s,i=n*s),c.push(r+" "+i)};for(let e=0;e<i;++e){let r=t(-u*e,e);e||(n=r),h(r)}if(void 0!==l){h(n);let e=(l||1)/100;e<=0&&(e=.002);for(let n=0;n<i;++n){let i=u*n,[s,o]=t(i,n),l=qe(o,s),a=[s-e*Ue(l),o-e*We(l)];n||(r=a),h(a)}h(r),h(n)}return c}(i,(t,n)=>{let r=Object.assign({},e,{t:t,"θ":t,seq:(...e)=>e.length?e[n%e.length]:""}),i=we(s,r),a=we(o,r);if(l){let e=we(l,r);i=e*Math.cos(t),a=e*Math.sin(t)}return e.rotate&&([i,a]=function(e,t,n){let r=De/180*n;return[e*Ue(r)-t*We(r),t*Ue(r)+e*We(r)]}(i,a,Number(e.rotate)||0)),e.origin&&([i,a]=function(e,t,n){let[r,i=r]=String(n).split(/[,\s]/).map(Number);return[e+(r||0),t+(i||0)]}(i,a,e.origin)),[i,a]})}function Ve(e,t){let n=[],i=[],s=[],o=[];if(J(e))return n;let l=r(h(e));for(;l.next();){let{prev:e,curr:r,next:u}=l.get();r.isSymbol("(")&&s.push(r.value),r.isSymbol(")")&&s.pop(),"open"===r.status&&o.push(r.value),"close"===r.status&&o.pop(),a=r,!(t?a.isSymbol(","):a.isSymbol(",")||a.isSpace())||s.length||o.length?i.push(r):(n.push(Xe(i)),i=[])}var a;return i.length&&n.push(Xe(i)),n}function Xe(e){return e.map(e=>e.value).join("")}function Ge(e){return e.filter(e=>!e.isSymbol(";","}")).map(e=>e.value).join("")}function Ze(e){let t=[],n=[];return e.forEach(e=>{e.isSymbol(",")?(t.push(Ge(n)),n=[]):n.push(e)}),n.length&&t.push(Ge(n)),t}function Ye(e,t){return function e(t,n){let r=[],i=[],s=n&&n.type||"";for(;t.next();){let{curr:o,next:l}=t.get();if("block"==s&&(!l||o.isSymbol("}"))){n.value=r;break}if("statement"==s&&(o.isSymbol(";")||l&&l.isSymbol("}"))){l&&l.isSymbol("}")&&i.push(o),n.value=Ge(i);break}if(o.isSymbol("{")){let n={type:"block",name:Ge(i),value:[]};n.name&&r.push(e(t,n)),i=[]}else if("statement"!==s&&o.isSymbol(":")&&i.length){let o=Ze(i),l=e(t,{type:"statement",name:"token",value:[]});o.forEach(e=>{r.push(Object.assign({},l,{name:e}))}),"block"==s&&(n.value=r),i=[]}else i.push(o)}return r.length&&"block"==s&&(n.value=r),i.length&&"statement"==s&&(n.value=Ge(i)),s?n:r}(r(h(e)),t||{type:"block",name:"svg",value:[]})}function Je(e){let t=r(h(e)),n={},i={commands:[],valid:!0};for(;t.next();){let{curr:e}=t.get();if(!e.isSpace()&&!e.isSymbol(","))if(e.isWord())n.name&&(i.commands.push(n),n={}),n.name=e.value,n.value=[],"MmLlHhVvCcSsQqTtAaZz".includes(e.value)?"mlhvcsqtaz".includes(e.value)?n.type="relative":n.type="absolute":(n.type="unknown",i.valid=!1);else if(n.value){let t=e.value;e.isNumber()&&(t=Number(e.value)),n.value.push(t)}else n.name||(i.valid=!1)}return n.name&&i.commands.push(n),i}const Ke={name:"cssd-uniform-time","animation-name":"cssd-uniform-time-animation","animation-duration":"31536000000","animation-iteration-count":"infinite","animation-delay":"0s","animation-direction":"normal","animation-fill-mode":"none","animation-play-state":"running","animation-timing-function":"linear"};function Qe(e){const{shuffle:t}=m(e),{pick:n,rand:r,nrand:i,unique_id:s}=ye(e),o={index:({count:e})=>t=>e,row:({y:e})=>t=>e,col:({x:e})=>t=>e,depth:({z:e})=>t=>e,size:({grid:e})=>t=>e.count,"size-row":({grid:e})=>t=>e.y,"size-col":({grid:e})=>t=>e.x,"size-depth":({grid:e})=>t=>e.z,id:({x:e,y:t,z:n})=>r=>Q(e,t,n),n:({extra:e})=>t=>e?e[0]+(Number(t)||0):"@n",nx:({extra:e})=>t=>e?e[1]+(Number(t)||0):"@nx",ny:({extra:e})=>t=>e?e[2]+(Number(t)||0):"@ny",N:({extra:e})=>t=>e?e[3]+(Number(t)||0):"@N",repeat:l(""),multiple:l(","),"multiple-with-space":l(" "),pick:({context:e})=>Pe((...t)=>a(e,"last_pick",n(t))),"pick-n"({context:e,extra:t,position:n}){let r="pn-counter"+n;return Pe((...n)=>{e[r]||(e[r]=0),e[r]+=1;let i=n.length,[s=e[r]]=t||[],o=n[(s-1)%i];return a(e,"last_pick",o)})},"pick-d"({context:e,extra:n,position:r}){let i="pd-counter"+r,s="pd-values"+r;return Pe((...r)=>{e[i]||(e[i]=0),e[i]+=1,e[s]||(e[s]=t(r));let o=r.length,[l=e[i]]=n||[],u=(l-1)%o,c=e[s][u];return a(e,"last_pick",c)})},"last-pick":({context:e})=>(t=1)=>{let n=e.last_pick;return n?n.last(t):""},rand:({context:e})=>(...t)=>{let n=(t.every(Z)?xe:ve)(r).apply(null,t);return a(e,"last_rand",n)},nrand:({context:e})=>(...t)=>{let n=(t.every(Z)?xe:ve)(i).apply(null,t);return a(e,"last_rand",n)},"rand-int":({context:e})=>(...t)=>{let n=(t.every(Z)?xe:ve)((...e)=>Math.round(r(...e))).apply(null,t);return a(e,"last_rand",n)},"nrand-int":({context:e})=>(...t)=>{let n=(t.every(Z)?xe:ve)((...e)=>Math.round(i(...e))).apply(null,t);return a(e,"last_rand",n)},"last-rand":({context:e})=>(t=1)=>{let n=e.last_rand;return n?n.last(t):""},stripe:()=>(...e)=>{let t,n=e.map(ee),r=n.length,i=0,s=[];if(!r)return"";n.forEach(e=>{let[t,n]=Ve(e);void 0!==n?s.push(n):i+=1});let o=s.length?`(100% - ${s.join(" - ")}) / ${i}`:"100% / "+r;return n.map((e,n)=>{if(s.length){let[n,r]=Ve(e);return t=(t?t+" + ":"")+(void 0!==r?r:o),`${n} 0 calc(${t})`}return`${e} 0 ${100/r*(n+1)}%`}).join(",")},reflect:()=>(...e)=>[...e,...e.slice(0,-1).reverse()].join(","),calc:()=>e=>we(ee(e)),hex:()=>e=>parseInt(ee(e)).toString(16),svg:K((...e)=>{let t=e.map(e=>ee(e()).trim()).join(",");return t.startsWith("<")||(t=ge(Ye(t))),fe(me(t))}),"svg-filter":K((...e)=>{let t=e.map(e=>ee(e()).trim()).join(","),n=s("filter-");return t.startsWith("<")||(t=ge(Ye(t,{type:"block",name:"filter"}))),fe(me(t).replace(/<filter([\s>])/,`<filter id="${n}"$1`),n)}),var:()=>e=>`var(${ee(e)})`,t:()=>e=>`var(--${Ke.name})`,point({count:e,context:t,extra:n,position:r,grid:i}){let s="offset-points"+r;return r=>{let[o=e,l,a,u=i.count]=n||[];if(!t[s]){let e=Oe(r);e.points=u,t[s]=Fe(e,{min:1,max:65536})}return t[s][o-1]}},Point({count:e,context:t,extra:n,position:r,grid:i}){let s="offset-points"+r;return r=>{let[o=e,l,a,u=i.count]=n||[];if(!t[s]){let e=Oe(r);e.points=u,e.absolute=!0,t[s]=Fe(e,{min:1,max:65536})}return t[s][o-1]}},shape:()=>Te("shape-function",(e="",...t)=>{let n=[];if((e=String(e).trim()).length)if("function"==typeof Be[e])n=Be[e](t);else{let r=e,i=t.join(",");i.length&&(r=e+","+i),n=Fe(Oe(r),{min:3,max:3600})}return`polygon(${n.join(",")})`}),doodle:()=>e=>e,shaders:()=>e=>e,canvas:()=>e=>e,path:()=>e=>e,invert:()=>e=>{let t=Je(e);return t.valid?t.commands.map(({name:e,value:t})=>{switch(e){case"v":return"h"+t.join(" ");case"V":return"H"+t.join(" ");case"h":return"v"+t.join(" ");case"H":return"V"+t.join(" ");default:return e+t.join(" ")}}).join(" "):e},flipH:()=>e=>{let t=Je(e);return t.valid?t.commands.map(({name:e,value:t})=>{switch(e){case"h":case"H":return e+t.map(u).join(" ");default:return e+t.join(" ")}}).join(" "):e},flipV:()=>e=>{let t=Je(e);return t.valid?t.commands.map(({name:e,value:t})=>{switch(e){case"v":case"V":return e+t.map(u).join(" ");default:return e+t.join(" ")}}).join(" "):e},flip(...e){let t=o.flipH(...e),n=o.flipV(...e);return e=>n(t(e))},reverse:(...e)=>e=>{let t=Je(e);return t.valid?t.commands.reverse().map(({name:e,value:t})=>e+t.join(" ")).join(" "):e}};function l(e){return K((t,...n)=>{if(!n||!t)return"";let r=ee(t()),i=we(r);return 0===i&&(i=r),function(e,t){let[n,r=1]=String(e).split("x");n=X(parseInt(n)||1,1,65536),r=X(parseInt(r)||1,1,65536);let i=n*r,s=[],o=1;for(let e=1;e<=r;++e)for(let r=1;r<=n;++r)s.push(t(o++,r,e,i));return s}(i,(...e)=>n.map(t=>ee(t(...e))).join(",")).join(e)})}function a(e,t,n){return e[t]||(e[t]=new Ne),e[t].push(n),n}function u(e){return-1*e}return c=o,h={m:"multiple",M:"multiple-with-space",r:"rand",rn:"nrand",ri:"rand-int",rni:"nrand-int",lr:"last-rand",p:"pick",pn:"pick-n",pd:"pick-d",lp:"last-pick",rep:"repeat",i:"index",x:"col",y:"row",z:"depth",I:"size",X:"size-col",Y:"size-row",Z:"size-depth",flipv:"flipV",fliph:"flipH",nr:"rn",nri:"nri",ms:"multiple-with-space",s:"size",sx:"size-col",sy:"size-row",sz:"size-depth","size-x":"size-col","size-y":"size-row","size-z":"size-depth",multi:"multiple","pick-by-turn":"pick-n","max-row":"size-row","max-col":"size-col",offset:"point",Offset:"Point",stripes:"stripe",strip:"stripe"},Object.keys(h).forEach(e=>{c[e]=c[h[e]]}),c;var c,h}Ke.animation=`\n  ${Ke["animation-duration"]}ms\n  ${Ke["animation-timing-function"]}\n  ${Ke["animation-delay"]}\n  ${Ke["animation-iteration-count"]}\n  ${Ke["animation-name"]}\n`;let et=[];function tt(e){if(!et.length){let e=new Set;for(let t in document.head.style)t.startsWith("-")||e.add(t.replace(/[A-Z]/g,"-$&").toLowerCase());e.has("grid-gap")||e.add("grid-gap"),et=Array.from(e)}return e&&e.test?et.filter(t=>e.test(t)):et}function nt(e){let t=new RegExp(`\\-?${e}\\-?`);return tt(t).map(e=>e.replace(t,"")).reduce((e,t)=>(e[t]=t,e),{})}const rt=nt("webkit"),it=nt("moz");function st(e,t){return rt[e]?`-webkit-${t} ${t}`:it[e]?`-moz-${t} ${t}`:t}const ot={"4a0":[1682,2378],"2a0":[1189,1682],a0:[841,1189],a1:[594,841],a2:[420,594],a3:[297,420],a4:[210,297],a5:[148,210],a6:[105,148],a7:[74,105],a8:[52,74],a9:[37,52],a10:[26,37],b0:[1e3,1414],b1:[707,1e3],b2:[500,707],b3:[353,500],b4:[250,353],b5:[176,250],b6:[125,176],b7:[88,125],b8:[62,88],b9:[44,62],b10:[31,44],b11:[22,32],b12:[16,22],c0:[917,1297],c1:[648,917],c2:[458,648],c3:[324,458],c4:[229,324],c5:[162,229],c6:[114,162],c7:[81,114],c8:[57,81],c9:[40,57],c10:[28,40],c11:[22,32],c12:[16,22],d0:[764,1064],d1:[532,760],d2:[380,528],d3:[264,376],d4:[188,260],d5:[130,184],d6:[92,126],letter:[216,279],postcard:[100,148],poster:[390,540]},lt={portrait:"p",pt:"p",p:"p",landscape:"l",ls:"l",l:"l"};var at={"@size"(e,{is_special_selector:t,grid:n}){let[r,i=r]=Ve(e);ot[r]&&([r,i]=function(e,t){e=String(e).toLowerCase();let[n,r]=ot[e]||[];return"p"==lt[t]&&([r,n]=[n,r]),[r,n].map(e=>e+"mm")}(r,i));let s=`\n      width: ${r};\n      height: ${i};\n    `;return t?"auto"!==r&&"auto"!==i||(s+=`aspect-ratio: ${n.ratio};`):s+=`\n        --internal-cell-width: ${r};\n        --internal-cell-height: ${i};\n      `,s},"@min-size"(e){let[t,n=t]=Ve(e);return`min-width: ${t}; min-height: ${n};`},"@max-size"(e){let[t,n=t]=Ve(e);return`max-width: ${t}; max-height: ${n};`},"@place-cell":(()=>{let e={center:"50%",left:"0%",right:"100%",top:"50%",bottom:"50%"},t={center:"50%",top:"0%",bottom:"100%",left:"50%",right:"50%"};return n=>{let[r,i="50%"]=Ve(n);r=e[r]||r,i=t[i]||i;const s="var(--internal-cell-width, 25%)",o="var(--internal-cell-height, 25%)";return`\n        position: absolute;\n        left: ${r};\n        top: ${i};\n        width: ${s};\n        height: ${o};\n        margin-left: calc(${s} / -2);\n        margin-top: calc(${o} / -2);\n        grid-area: unset;\n      `}})(),"@grid"(e,t){let[n,...r]=e.split("/").map(e=>e.trim());return r=r.join(" / "),{grid:ae(n),size:r?this["@size"](r,t):""}},"@shape":Te("shape-property",e=>{let[t,...n]=Ve(e);return"function"!=typeof Be[t]?"":st("clip-path",`clip-path: polygon(${Be[t](...n).join(",")});`)+"overflow: hidden;"}),"@use"(e){if(e.length>2)return e}};function ut(e,t,n){for(let r=0;r<=n;++r)if(we(e,{n:r})==t)return!0}const ct={even:e=>!(e%2),odd:e=>!!(e%2)};function ht(e){return/^(even|odd)$/.test(e)}var pt=Object.getOwnPropertyNames(Math).reduce((e,t)=>(e[t]=()=>(...e)=>(e=e.map(ee),"number"==typeof Math[t]?Math[t]:Math[t].apply(null,e.map(we))),e),{});const dt={length:"0px",number:0,color:"black",url:"url()",image:"url()",integer:0,angle:"0deg",time:"0ms",resolution:"0dpi",percentage:"0%","length-percentage":"0%","transform-function":"translate(0)","transform-list":"translate(0)","custom-ident":"_"};let{join:ft,make_array:mt,remove_empty_values:gt}=m();function yt(e){return/^\:(host|doodle)/.test(e)}function vt(e){return/^\:(container|parent)/.test(e)}function xt(e){return yt(e)||vt(e)}class bt{constructor(e,t){this.tokens=e,this.rules={},this.props={},this.keyframes={},this.grid=null,this.is_grid_defined=!1,this.coords=[],this.doodles={},this.canvas={},this.shaders={},this.paths={},this.reset(),this.Func=Qe(t),this.Selector=function(e){return{at:({x:e,y:t})=>(n,r)=>e==n&&t==r,nth:({count:e,grid:t})=>(...n)=>n.some(n=>ht(n)?ct[n](e):ut(n,e,t.count)),row:({y:e,grid:t})=>(...n)=>n.some(n=>ht(n)?ct[n](e):ut(n,e,t.y)),col:({x:e,grid:t})=>(...n)=>n.some(n=>ht(n)?ct[n](e):ut(n,e,t.x)),even:({count:e,grid:t,y:n})=>r=>{if("cross"===r&&ct.even(t.x)){let t=ct.even(n)?"odd":"even";return ct[t](e)}return ct.even(e)},odd:({count:e,grid:t,y:n})=>r=>{if("cross"===r&&ct.even(t.x)){let t=ct.even(n)?"even":"odd";return ct[t](e)}return ct.odd(e)},random:()=>(t=.5)=>(t>=1&&t<=0&&(t=.5),e()<t)}}(t),this.custom_properties={},this.uniforms={},this.unique_id=ye(t).unique_id}reset(){this.styles={host:"",container:"",cells:"",keyframes:""},this.coords=[],this.doodles={},this.canvas={},this.shaders={};for(let e in this.rules)e.startsWith("#c")&&delete this.rules[e]}add_rule(e,t){let n=this.rules[e];n||(n=this.rules[e]=[]),n.push.apply(n,mt(t))}pick_func(e){return this.Func[e]||pt[e]}apply_func(e,t,n){let r=e(...mt(t)),i=[];return n.forEach(e=>{let t=typeof e.value,n="number"===t||"string"===t;if(!e.cluster&&n)i.push(...Ve(e.value,!0));else if("function"==typeof e)i.push(e);else if(!Y(e.value)){let t=ee(e.value);i.push(t)}}),i=gt(i),r(...mt(i))}compose_aname(...e){return e.join("-")}compose_selector({x:e,y:t,z:n},r=""){return`#${Q(e,t,n)}${r}`}is_composable(e){return["doodle","shaders","canvas"].includes(e)}compose_argument(e,t,n=[]){let r=e.map(e=>{if("text"===e.type)return e.value;if("func"===e.type){let r=e.name.substr(1),i=this.pick_func(r);if("function"==typeof i){if("t"===r&&(this.uniforms.time=!0),this.is_composable(r)){let n=ee((e.arguments[0]||[])[0]);if(!Y(n))switch(r){case"doodle":return this.compose_doodle(n);case"shaders":return this.compose_shaders(n,t);case"canvas":return this.compose_canvas(n,t)}}t.extra=n,t.position=e.position;let s=e.arguments.map(e=>i.lazy?(...n)=>this.compose_argument(e,t,n):this.compose_argument(e,t,n)),o=this.apply_func(i,t,s);return"path"==r?this.compose_path(o):o}}});return{cluster:e.cluster,value:r.length>=2?{value:r.join("")}:r[0]}}compose_doodle(e){let t=this.unique_id("doodle");return this.doodles[t]=e,"${"+t+"}"}compose_shaders(e,{x:t,y:n,z:r}){let i=this.unique_id("shader");return this.shaders[i]={shader:e,cell:Q(t,n,r)},"${"+i+"}"}compose_canvas(e,{x:t,y:n,z:r}){let i=this.unique_id("canvas");return this.canvas[i]={code:e,cell:Q(t,n,r)},"${"+i+"}"}compose_path(e){let t=this.unique_id("path");return this.paths[t]={id:t,commands:e},"${"+t+"}"}compose_value(e,t){return Array.isArray(e)?e.reduce((e,n)=>{switch(n.type){case"text":e+=n.value;break;case"func":{let r=n.name.substr(1),i=this.pick_func(r);if("function"==typeof i)if("t"===r&&(this.uniforms.time=!0),this.is_composable(r)){let i=ee((n.arguments[0]||[])[0]);if(!Y(i))switch(r){case"doodle":e+=this.compose_doodle(i);break;case"shaders":e+=this.compose_shaders(i,t);break;case"canvas":e+=this.compose_canvas(i,t)}}else{t.position=n.position;let s=n.arguments.map(e=>i.lazy?(...n)=>this.compose_argument(e,t,n):this.compose_argument(e,t)),o=this.apply_func(i,t,s);Y(o)||(e+="path"==r?this.compose_path(o):o)}}}return e},""):""}compose_rule(e,t,n){let r=Object.assign({},t),i=e.property,s=e.value.reduce((e,t)=>{let n=this.compose_value(t,r);return n&&e.push(n),e},[]),o=s.join(", ");if(/^animation(\-name)?$/.test(i)){if(this.props.has_animation=!0,yt(n)){let e=Ke[i];e&&o&&(o=e+","+o)}if(r.count>1){let{count:e}=r;switch(i){case"animation-name":o=s.map(t=>this.compose_aname(t,e)).join(", ");break;case"animation":o=s.map(t=>{let n=(t||"").split(/\s+/);return n[0]=this.compose_aname(n[0],e),n.join(" ")}).join(", ")}}}"content"===i&&(/["']|^none$|^(var|counter|counters|attr)\(/.test(o)||(o=`'${o}'`)),"transition"===i&&(this.props.has_transition=!0);let l=`${i}: ${o};`;if(l=st(i,l),"clip-path"===i&&(l+=";overflow: hidden;"),"width"!==i&&"height"!==i||xt(n)||(l+=`--internal-cell-${i}: ${o};`),"background"===i&&(o.includes("shader")||o.includes("canvas"))&&(l+="background-size: 100% 100%;"),/^\-\-/.test(i)&&(this.custom_properties[i]=o),at[i]){let t=at[i](o,{is_special_selector:xt(n),grid:r.grid});switch(i){case"@grid":yt(n)?l=t.size||"":(l="",this.is_grid_defined||(t=at[i](o,{is_special_selector:!0,grid:r.grid}),this.add_rule(":host",t.size||""))),this.grid=r.grid,this.is_grid_defined=!0;break;case"@place-cell":yt(n)||(l=t);break;case"@use":e.value.length&&this.compose(r,e.value),l="";break;default:l=t}}return l}pre_compose_rule(e,t){let n=Object.assign({},t),r=e.property;switch(r){case"@grid":{let t=e.value.reduce((e,t)=>{let r=this.compose_value(t,n);return r&&e.push(r),e},[]).join(", "),i=at[r](t,{});this.grid=i.grid;break}case"@use":e.value.length&&this.pre_compose(n,e.value)}}pre_compose(e,t){(t||this.tokens).forEach(t=>{switch(t.type){case"rule":this.pre_compose_rule(t,e);break;case"pseudo":yt(t.selector)&&(t.styles||[]).forEach(t=>{this.pre_compose_rule(t,e)})}})}compose(e,t,n){this.coords.push(e),(t||this.tokens).forEach((t,r)=>{if(t.skip)return!1;if(n&&this.grid)return!1;switch(t.type){case"rule":this.add_rule(this.compose_selector(e),this.compose_rule(t,e));break;case"pseudo":{t.selector.startsWith(":doodle")&&(t.selector=t.selector.replace(/^\:+doodle/,":host"));let n=xt(t.selector);n&&(t.skip=!0),t.selector.split(",").forEach(r=>{let i=t.styles.map(t=>this.compose_rule(t,e,r)),s=n?r:this.compose_selector(e,r);this.add_rule(s,i)});break}case"cond":{let n=this.Selector[t.name.substr(1)];if(n){let r=t.arguments.map(t=>this.compose_argument(t,e));this.apply_func(n,e,r)&&this.compose(e,t.styles)}break}case"keyframes":this.keyframes[t.name]||(this.keyframes[t.name]=e=>`\n              ${ft(t.steps.map(t=>`\n                ${t.name} {\n                  ${ft(t.styles.map(t=>this.compose_rule(t,e)))}\n                }\n              `))}\n            `)}})}output(){Object.keys(this.rules).forEach((e,t)=>{if(vt(e))this.styles.container+=`\n          .container {\n            ${ft(this.rules[e])}\n          }\n        `;else{let t=yt(e)?"host":"cells",n=ft(this.rules[e]).trim(),r="host"===t?e+", .host":e;this.styles[t]+=`${r} { ${n} }`}});let e=Object.keys(this.keyframes);this.uniforms.time&&(this.styles.container+=`\n        :host, .host {\n          animation: ${Ke.animation};\n        }\n      `,this.styles.keyframes+=`\n       @keyframes ${Ke["animation-name"]} {\n         from { --${Ke.name}: 0 }\n         to { --${Ke.name}: ${Ke["animation-duration"]} }\n       }\n      `),this.coords.forEach((t,n)=>{e.forEach(e=>{let r=this.compose_aname(e,t.count);var i,s;this.styles.keyframes+=`\n          ${i=0===n,s=`@keyframes ${e} {\n              ${this.keyframes[e](t)}\n            }`,i?"function"==typeof s?s():s:""}\n          @keyframes ${r} {\n            ${this.keyframes[e](t)}\n          }\n        `})});let t=[];return Object.keys(this.custom_properties).forEach(e=>{let n=function(e){let t=String(e).substr(2).split("-")[0];if(void 0!==dt[t])return{name:e,syntax:`<${t}> | <${t}>+ | <${t}>#`,initialValue:dt[t],inherits:!1}}(e);n&&t.push(n)}),{props:this.props,styles:this.styles,grid:this.grid,doodles:this.doodles,shaders:this.shaders,paths:this.paths,canvas:this.canvas,definitions:t,uniforms:this.uniforms}}}function _t(e,t,n){let r=new bt(e,n),i={};r.pre_compose({x:1,y:1,z:1,count:1,context:{},grid:{x:1,y:1,z:1,count:1}});let{grid:s}=r.output();if(s&&(t=s),r.reset(),1==t.z)for(let e=1,n=0;e<=t.y;++e)for(let s=1;s<=t.x;++s)r.compose({x:s,y:e,z:1,count:++n,grid:t,context:i});else for(let e=1,n=0;e<=t.z;++e)r.compose({x:1,y:1,z:e,count:++n,grid:t,context:i});return r.output()}var wt=window,kt=Math,$t=[],St=kt.pow(256,6),Et=kt.pow(2,52),jt=2*Et;function zt(e,t,n){var r=[],i=Rt(function e(t,n){var r,i=[],s=typeof t;if(n&&"object"==s)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==s?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,Pt($t)]:null==e?function(){try{var e;return e=new Uint8Array(256),(wt.crypto||wt.msCrypto).getRandomValues(e),Pt(e)}catch(e){var t=wt.navigator,n=t&&t.plugins;return[+new Date,wt,n,wt.screen,Pt($t)]}}():e,3),r),s=new Tt(r),o=function(){for(var e=s.g(6),t=St,n=0;e<Et;)e=256*(e+n),t*=256,n=s.g(1);for(;e>=jt;)e/=2,t/=2,n>>>=1;return(e+n)/t};return o.int32=function(){return 0|s.g(4)},o.quick=function(){return s.g(4)/4294967296},o.double=o,Rt(Pt(s.S),$t),(t.pass||n||function(e,t,n,r){return r&&(r.S&&At(r,s),e.state=function(){return At(s,{})}),n?(kt.random=e,t):e})(o,i,"global"in t?t.global:this==kt,t.state)}function Tt(e){var t,n=e.length,r=this,i=0,s=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);i<256;)o[i]=i++;for(i=0;i<256;i++)o[i]=o[s=255&s+e[i%n]+(t=o[i])],o[s]=t;(r.g=function(e){for(var t,n=0,i=r.i,s=r.j,o=r.S;e--;)t=o[i=255&i+1],n=256*n+o[255&(o[i]=o[s=255&s+t])+(o[s]=t)];return r.i=i,r.j=s,n})(256)}function At(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function Rt(e,t){for(var n,r=e+"",i=0;i<r.length;)t[255&i]=255&(n^=19*t[255&i])+r.charCodeAt(i++);return Pt(t)}function Pt(e){return String.fromCharCode.apply(0,e)}function Ct(e,t,n){let r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}function Mt(e,t){return e.includes(t)?e:t+"\n"+e}function Lt(e,t,n){let r=document.createElement("canvas"),i=window.devicePixelRatio||1;t*=i,n*=i,r.width=t,r.height=n;let s=r.getContext("webgl")||r.getContext("exprimental-webgl");if(!s)return Promise.resolve("");let o=Mt(e.fragment||"","uniform vec2 u_resolution;");e.textures.forEach(e=>{let t=`uniform sampler2D ${e.name};`;o=Mt(o,t)});let l=function(e,t,n){let r=Ct(e,e.VERTEX_SHADER,t),i=Ct(e,e.FRAGMENT_SHADER,n),s=e.createProgram();return e.attachShader(s,r),e.attachShader(s,i),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||(console.warn("Link failed: "+e.getProgramInfoLog(s)),console.warn("vs info-log: "+e.getShaderInfoLog(r)),console.warn("fs info-log: "+e.getShaderInfoLog(i))),s}(s,e.vertex||"\n  attribute vec4 position;\n  void main() {\n    gl_Position = position;\n  }\n","\n  precision highp float;\n"+o),a=s.getAttribLocation(l,"position"),u=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,u),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1,-1,1,1,-1]),s.STATIC_DRAW),s.enableVertexAttribArray(a),s.vertexAttribPointer(a,2,s.FLOAT,!1,0,0),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.useProgram(l),s.uniform2fv(s.getUniformLocation(l,"u_resolution"),[t,n]),e.textures.forEach((e,t)=>{!function(e,t,n){const r=e.createTexture();e.activeTexture(e["TEXTURE"+n]),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}(s,e.value,t),s.uniform1i(s.getUniformLocation(l,e.name),t)}),s.drawArrays(s.TRIANGLES,0,6),Promise.resolve(r.toDataURL())}Rt(kt.random(),$t);class Nt extends HTMLElement{constructor(){super(),this.doodle=this.attachShadow({mode:"open"}),this.extra={get_variable:e=>function(e,t){return getComputedStyle(e).getPropertyValue(t).trim().replace(/^\(|\)$/g,"")}(this,e)}}connectedCallback(e){/^(complete|interactive|loaded)$/.test(document.readyState)?this.load(e):setTimeout(()=>this.load(e))}update(e){let t=this.get_use();e||(e=this.innerHTML),this.innerHTML=e,this.grid_size||(this.grid_size=this.get_grid());let{x:n,y:r,z:i}=this.grid_size;const s=this.generate(V(t+e,this.extra));if(!this.shadowRoot.innerHTML)return Object.assign(this.grid_size,s.grid),this.build_grid(s,s.grid);if(s.grid){let{x:e,y:t,z:o}=s.grid;if(n!==e||r!==t||i!==o)return Object.assign(this.grid_size,s.grid),this.build_grid(s,s.grid);Object.assign(this.grid_size,s.grid)}else{let s=this.get_grid(),{x:o,y:l,z:a}=s;if(n!==o||r!==l||i!==a)return Object.assign(this.grid_size,s),this.build_grid(this.generate(V(t+e,this.extra)),s)}let o=this.build_svg_paths(s.paths);if(o){let e=this.shadowRoot.querySelector(".svg-defs");e&&(e.innerHTML=o)}s.uniforms.time&&this.register_uniform_time();let l=this.replace(s);this.set_content(".style-keyframes",l(s.styles.keyframes)),s.props.has_animation&&(this.set_content(".style-cells",""),this.set_content(".style-container","")),setTimeout(()=>{this.set_content(".style-container",l(It(this.grid_size)+s.styles.host+s.styles.container)),this.set_content(".style-cells",l(s.styles.cells))})}get grid(){return Object.assign({},this.grid_size)}set grid(e){this.attr("grid",e),this.connectedCallback(!0)}get seed(){return this._seed_value}set seed(e){this.attr("seed",e),this.connectedCallback(!0)}get use(){return this.attr("use")}set use(e){this.attr("use",e),this.connectedCallback(!0)}static get observedAttributes(){return["grid","use","seed"]}attributeChangedCallback(e,t,n){if(t==n)return!1;["grid","use","seed"].includes(e)&&!Y(t)&&(this[e]=n)}get_grid(){return ae(this.attr("grid"))}get_use(){let e=this.attr("use")||"";return e&&(e=`@use:${e};`),e}attr(e,t){return 1===arguments.length?this.getAttribute(e):2===arguments.length?(this.setAttribute(e,t),t):void 0}generate(e){let t=this.get_grid(),n=this.attr("seed")||this.attr("data-seed");Y(n)&&(n=Date.now()),n=String(n),this._seed_value=n;let r=this.random=zt(n);return this.compiled=_t(e,t,r)}doodle_to_image(e,t,n){"function"==typeof t&&(n=t,t=null);let r=V(e,this.extra),i=ae({}),s=_t(r,i,this.random),o=s.grid?s.grid:i;const{keyframes:l,host:a,container:u,cells:c}=s.styles;let h=this.build_svg_paths(s.paths),p=this.replace(s),d=Wt(o);p(`\n      <svg ${t&&t.width&&t.height?`width="${t.width}" height="${t.height}"`:""} xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">\n        <foreignObject width="100%" height="100%">\n          <div class="host" xmlns="http://www.w3.org/1999/xhtml">\n            <style>\n              ${Ot()}\n              ${It(o)}\n              ${a}\n              ${u}\n              ${c}\n              ${l}\n            </style>\n            <svg xmlns="http://www.w3.org/2000/svg" style="width:0; height:0">\n              <defs class="svg-defs">${h}</defs>\n            </svg>\n            ${d}\n          </div>\n        </foreignObject>\n      </svg>\n    `).then(e=>{let t="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e)));ne()&&te(t),n(t)})}canvas_to_image({code:e,cell:t},n){let r=this.doodle.getElementById(t),{width:i,height:s}=r&&r.getBoundingClientRect()||{width:0,height:0};(function(e,t,n,r){e=re(e);let i=document.createElement("canvas"),s=i.getContext("2d"),o=window.devicePixelRatio||1;i.style.width=i.width+"px",i.style.height=i.height+"px",i.width=t*o,i.height=n*o,s.scale(o,o);try{new Function(`return (ctx, width, height, random) => {${e}}`)()(s,t,n,r)}catch(e){}return Promise.resolve(i.toDataURL())})(e,i,s,this.random).then(n)}shader_to_image({shader:e,cell:t},n){let i=function(e){let t,n,i=r(he(h(e))),s=[],o=[],l={textures:[]};for(;i.next();){let{curr:e,next:r}=i.get();if(e.isSymbol("{")){if(s.length)o.push(e);else{let n=pe(o);ue(n)?(t=n,o=[]):o.push(e)}s.push("{")}else if(e.isSymbol("}"))if(s.pop(),!s.length&&t){let e=pe(o);t&&e.length&&(t.startsWith("texture")?l.textures.push({name:t,value:e}):l[t]=e,o=[]),t=null}else o.push(e);else J(n)||n==e.pos[1]||(o.push(ce()),n=null),e.isWord()&&e.value.startsWith("#")&&(o.push(ce()),n=r.pos[1]),o.push(e)}return J(l.fragment)?{fragment:pe(o),textures:[]}:l}(e),s=this.doodle.getElementById(t),{width:o,height:l}=s&&s.getBoundingClientRect()||{width:0,height:0},a=window.devicePixelRatio||1;if(i.textures.length){let e=i.textures.map(e=>new Promise(t=>{this.doodle_to_image(e.value,{width:o,height:l},n=>{let r=new Image;r.width=o*a,r.height=l*a,r.onload=()=>t({name:e.name,value:r}),r.src=n})}));Promise.all(e).then(e=>{i.textures=e,Lt(i,o,l).then(n)})}else Lt(i,o,l).then(n)}load(e){e||this.hasAttribute("click-to-update")&&this.addEventListener("click",e=>this.update());let t=this.get_use();if(!this.innerHTML.trim()&&!t)return!1;let n=V(t+re(this.innerHTML),this.extra),r=this.generate(n);this.grid_size=r.grid?r.grid:this.get_grid(),this.build_grid(r,this.grid_size)}replace({doodles:e,shaders:t,paths:n,canvas:r}){let i=Object.keys(e),s=Object.keys(t),o=Object.keys(n),l=Object.keys(r);return n=>{if(!(i.length||s.length||o.length||l.length))return Promise.resolve(n);let a=[].concat(i.map(t=>n.includes(t)?new Promise(n=>{this.doodle_to_image(e[t],e=>n({id:t,value:e}))}):Promise.resolve("")),s.map(e=>n.includes(e)?new Promise(n=>{this.shader_to_image(t[e],t=>n({id:e,value:t}))}):Promise.resolve("")),l.map(e=>n.includes(e)?new Promise(t=>{this.canvas_to_image(r[e],n=>t({id:e,value:n}))}):Promise.resolve("")),o.map(e=>n.includes(e)?Promise.resolve({id:e,value:"#"+e}):Promise.resolve("")));return Promise.all(a).then(e=>(n.replaceAll?e.forEach(({id:e,value:t})=>{n=n.replaceAll("${"+e+"}",`url(${t})`)}):e.forEach(({id:e,value:t})=>{n=n.replace("${"+e+"}",`url(${t})`)}),n))}}build_grid(e,t){const{has_transition:n,has_animation:r}=e.props;let i=n||r;const{keyframes:s,host:o,container:l,cells:a}=e.styles;let u=It(t)+o+l,c=i?"":a,h=this.build_svg_paths(e.paths);const{uniforms:p}=e;let d=this.replace(e);this.doodle.innerHTML=`\n      <style>${Ot(p)}</style>\n      <style class="style-keyframes">${s}</style>\n      <style class="style-container">${u}</style>\n      <style class="style-cells">${c}</style>\n      <svg xmlns="http://www.w3.org/2000/svg" style="width:0;height:0">\n        <defs class="svg-defs">${h}</defs>\n      </svg>\n      ${Wt(t)}\n    `,this.set_content(".style-container",d(u)),i?setTimeout(()=>{this.set_content(".style-cells",d(a))},50):this.set_content(".style-cells",d(a));const f=e.definitions;if(window.CSS&&window.CSS.registerProperty)try{p.time&&this.register_uniform_time(),f.forEach(CSS.registerProperty)}catch(e){}}build_svg_paths(e){return Object.keys(e||{}).map(t=>`\n      <clipPath id="${e[t].id}" clipPathUnits="objectBoundingBox">\n        <path d="${e[t].commands}" />\n      </clipPath>\n    `).join("")}register_uniform_time(){if(!this.is_uniform_time_registered){try{CSS.registerProperty({name:"--"+Ke.name,syntax:"<number>",initialValue:0,inherits:!0})}catch(e){}this.is_uniform_time_registered=!0}}export({scale:e,name:t,download:n,detail:r}={}){return new Promise((i,s)=>{let o=function(e){let t={};if(e.computedStyleMap)for(let[n,r]of e.computedStyleMap())n.startsWith("--")&&(t[n]=r[0][0]);else{let n=getComputedStyle(e);for(let e of n)e.startsWith("--")&&(t[e]=n.getPropertyValue(e))}return function(e){let t=[];for(let n in e)t.push(n+":"+e[n]);return t.join(";")}(t)}(this),l=this.doodle.innerHTML,{width:a,height:u}=this.getBoundingClientRect(),c=a*(e=parseInt(e)||1),h=u*e,p=`\n        <svg xmlns="http://www.w3.org/2000/svg"\n          preserveAspectRatio="none"\n          viewBox="0 0 ${a} ${u}"\n          ${ne()?"":`width="${c}px" height="${h}px"`}\n        >\n          <foreignObject width="100%" height="100%">\n            <div\n              class="host"\n              xmlns="http://www.w3.org/1999/xhtml"\n              style="width: ${a}px; height: ${u}px; "\n            >\n              <style>.host { ${d=o,d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")} }</style>\n              ${l}\n            </div>\n          </foreignObject>\n        </svg>\n      `.replace(/\n\s+|^\s+|\n+/g," ").trim();var d;n||r?function(e,t,n,r){return new Promise((i,s)=>{let o="data:image/svg+xml;utf8,"+encodeURIComponent(e);function l(){let e=new Image;e.crossOrigin="anonymous",e.src=o,e.onload=()=>{let l=document.createElement("canvas"),a=l.getContext("2d"),u=window.devicePixelRatio||1;1!=r&&(u=1),l.width=t*u,l.height=n*u,a.drawImage(e,0,0,l.width,l.height);try{l.toBlob(e=>{i({blob:e,source:o,url:URL.createObjectURL(e)})})}catch(e){s(e)}}}ne()?te(o,l,200):l()})}(p,c,h,e).then(({source:e,url:r,blob:s})=>{if(i({width:c,height:h,svg:p,blob:s,source:e}),n){let e=document.createElement("a");e.download=function(e){return(Y(e)?Date.now():String(e).replace(/\/.png$/g,""))+".png"}(t),e.href=r,e.click()}}).catch(e=>{s(e)}):i({width:c,height:h,svg:p})})}set_content(e,t){if(t instanceof Promise)t.then(t=>{this.set_content(e,t)});else{const n=this.shadowRoot.querySelector(e);n&&(n.styleSheet?n.styleSheet.cssText=t:n.innerHTML=t)}}}function Ot(e={}){const t=tt(/grid/).map(e=>e+": inherit;").join("");return`\n    * {\n      box-sizing: border-box\n    }\n    *::after, *::before {\n      box-sizing: inherit\n    }\n    :host, .host {\n      display: block;\n      visibility: visible;\n      width: auto;\n      height: auto;\n      --${Ke.name}: 0\n    }\n    :host([hidden]), .host[hidden] {\n      display: none\n    }\n    .container {\n      position: relative;\n      width: 100%;\n      height: 100%;\n      display: grid;\n      ${t}\n    }\n    cell:empty {\n      position: relative;\n      line-height: 1;\n      display: grid;\n      place-items: center\n    }\n    svg {\n      position: absolute;\n      width: 100%;\n      height: 100%;\n    }\n  `}function It(e){let{x:t,y:n}=e||{};return`\n    :host, .host {\n      grid-template-rows: repeat(${n}, 1fr);\n      grid-template-columns: repeat(${t}, 1fr);\n    }\n  `}function Ut(e,t,n){let r=document.createElement("cell");return r.id=Q(e,t,n),r}function Wt(e){let{x:t,y:n,z:r}=e||{},i=document.createElement("grid"),s=document.createDocumentFragment();if(1==r)for(let e=1;e<=n;++e)for(let n=1;n<=t;++n)s.appendChild(Ut(n,e,1));else{let e=null;for(let t=1;t<=r;++t){let n=Ut(1,1,t);(e||s).appendChild(n),e=n}e=null}return i.className="container",i.appendChild(s),i.outerHTML}return customElements.get("css-doodle")||customElements.define("css-doodle",Nt),ie(e=>{let t=document.createElement("css-doodle");return t.update&&t.update(e),t})}()}}]);